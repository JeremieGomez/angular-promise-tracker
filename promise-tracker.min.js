/*
 * promise-tracker - v2.0.0-beta1 - 2014-01-27
 * http://github.com/ajoslin/angular-promise-tracker
 * Created by Andy Joslin; Licensed under Public Domain
 */

(function() {
function TrackerHttpInterceptor(a,b){return{request:function(c){return c.tracker&&(angular.isArray(c.tracker)||(c.tracker=[c.tracker]),c.$promiseTrackerDeferred=c.$promiseTrackerDeferred||[],angular.forEach(c.tracker,function(a){var d=b(a).createPromise(c);c.$promiseTrackerDeferred.push(d)})),a.when(c)},response:function(b){return b.config&&b.config.$promiseTrackerDeferred&&angular.forEach(b.config.$promiseTrackerDeferred,function(a){a.resolve(b)}),a.when(b)},responseError:function(b){return b.config&&b.config.$promiseTrackerDeferred&&angular.forEach(b.config.$promiseTrackerDeferred,function(a){a.reject(b)}),a.reject(b)}}}angular.module("ajoslin.promise-tracker",[]),angular.module("ajoslin.promise-tracker").config(["$httpProvider",function(a){a.interceptors.push(TrackerHttpInterceptor)}]),TrackerHttpInterceptor.$inject=["$q","promiseTracker"],angular.module("ajoslin.promise-tracker").provider("promiseTracker",function(){var a={};this.$get=["$q","$timeout",function(b,c){function d(b){if(!a[b])throw new Error('Tracker with id "'+b+'" does not exist! Use promiseTracker.register()');return a[b]}function e(a){a=a||{};var d,e,f,g=[],h=this,i=a.minDuration,j=a.maxDuration,k=a.activationDelay;h._destroy=function(){d=cancelTimeout(d),e=cancelTimeout(e),f=cancelTimeout(f),h.cancel()},h.active=function(){return f?!1:g.length>0},h.cancel=function(){for(var a=g.length-1;a>=0;a--)g[a].resolve()},h.createPromise=function(){function a(){i&&(d=c(angular.noop,i)),j&&(e=c(l.resolve,j))}function h(){return function(){(d||b.when()).then(function(){var a=g.indexOf(l);g.splice(a,1),0===g.length&&(e=cancelTimeout(e),f=cancelTimeout(f))})}}var l=b.defer();return g.push(l),1===g.length&&(k?f=c(function(){f&&(f=cancelTimeout(f))},k):a()),l.promise.then(h(!1),h(!0)),l},h.addPromise=function(a){var c=a&&(a.then||a.$then||a.$promise&&a.$promise.then);if(!c)throw new Error("promiseTracker#addPromise expects a promise object!");var d=h.createPromise();return c(function(a){return d.resolve(a),a},function(a){return d.reject(a),b.reject(a)}),d}}return d.register=function(b,c){if(a[b])throw new Error('Tracker with id "'+b+'" already exists!');return a[b]=new e(c),a[b]},d.deregister=function(b){a[b]&&(a[b]._destroy(),delete a[b])},d}]});
}());